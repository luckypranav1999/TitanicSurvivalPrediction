<!DOCTYPE html>
<html>
<head>
    <title>Titanic Survival Predictor</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            background: #eef2f7;
            padding: 20px;
        }
        .container {
            background: #fff;
            padding: 20px 24px;
            max-width: 450px;
            margin: auto;
            border-radius: 12px;
            box-shadow: 0 8px 20px rgba(0,0,0,0.08);
        }
        h2 {
            text-align: center;
            margin-top: 0;
            color: #1f2933;
        }
        label {
            font-size: 14px;
            font-weight: 600;
            color: #3c4858;
        }
        input, select, button {
            width: 100%;
            padding: 10px;
            margin: 6px 0 14px;
            border-radius: 6px;
            border: 1px solid #cbd2e1;
            font-size: 14px;
            box-sizing: border-box;
        }
        input:focus, select:focus {
            outline: none;
            border-color: #0078d7;
            box-shadow: 0 0 0 2px rgba(0,120,215,0.15);
        }
        button {
            background: #0078d7;
            color: white;
            border: none;
            cursor: pointer;
            font-weight: 600;
        }
        button:hover {
            background: #005fa3;
        }
        button:disabled {
            opacity: 0.6;
            cursor: not-allowed;
        }
        .error {
            color: #d9534f;
            font-size: 13px;
            min-height: 18px;
        }
        .result-card {
            margin-top: 18px;
            padding: 14px 16px;
            border-radius: 10px;
            display: none;
        }
        .result-title {
            font-weight: 700;
            margin-bottom: 6px;
            font-size: 16px;
        }
        .result-detail {
            font-size: 14px;
        }
        .result-survived {
            background: #e6ffed;
            border: 1px solid #32a852;
            color: #225b30;
        }
        .result-not-survived {
            background: #ffecec;
            border: 1px solid #e53935;
            color: #8b1c1a;
        }
        .probability-bar-container {
            margin-top: 10px;
            background: #e5e7eb;
            border-radius: 999px;
            height: 10px;
            overflow: hidden;
        }
        .probability-bar {
            height: 100%;
            width: 0;
            transition: width 0.4s ease;
        }
        .probability-value {
            font-size: 13px;
            margin-top: 4px;
            color: #4b5563;
        }
        .loading {
            font-size: 13px;
            color: #6b7280;
            margin-top: 6px;
        }
    </style>
</head>
<body>
    <div class="container">
        <h2>Titanic Survival Predictor</h2>
        <form id="predictForm">
            <label>Pclass:</label>
            <select id="pclass" required>
                <option value="">Select Class</option>
                <option value="1">1st Class</option>
                <option value="2">2nd Class</option>
                <option value="3">3rd Class</option>
            </select>

            <label>Sex:</label>
            <select id="sex" required>
                <option value="">Select Sex</option>
                <option value="male">Male</option>
                <option value="female">Female</option>
            </select>

            <label>Age:</label>
            <input type="number" id="age" min="0" required>

            <label>SibSp:</label>
            <input type="number" id="sibsp" min="0" required>

            <label>Parch:</label>
            <input type="number" id="parch" min="0" required>

            <label>Fare:</label>
            <input type="number" id="fare" min="0" step="0.01" required>

            <label>Embarked:</label>
            <select id="embarked" required>
                <option value="">Select Port</option>
                <option value="C">Cherbourg</option>
                <option value="Q">Queenstown</option>
                <option value="S">Southampton</option>
            </select>

            <button type="submit" id="predictBtn">Predict</button>
            <p class="error" id="errorMsg"></p>
            <p class="loading" id="loadingMsg"></p>

            <div id="resultCard" class="result-card">
                <div class="result-title" id="resultTitle"></div>
                <div class="result-detail" id="resultDetail"></div>
                <div class="probability-bar-container">
                    <div class="probability-bar" id="probBar"></div>
                </div>
                <div class="probability-value" id="probValue"></div>
            </div>
        </form>
    </div>

    <script>
        const form = document.getElementById("predictForm");
        const errorMsg = document.getElementById("errorMsg");
        const loadingMsg = document.getElementById("loadingMsg");
        const resultCard = document.getElementById("resultCard");
        const resultTitle = document.getElementById("resultTitle");
        const resultDetail = document.getElementById("resultDetail");
        const probBar = document.getElementById("probBar");
        const probValue = document.getElementById("probValue");
        const predictBtn = document.getElementById("predictBtn");

        form.addEventListener("submit", async function(e) {
            e.preventDefault();

            // basic validation
            let inputs = ["pclass","sex","age","sibsp","parch","fare","embarked"];
            for (let id of inputs) {
                if (document.getElementById(id).value === "") {
                    errorMsg.innerText = "Please fill all fields.";
                    return;
                }
            }
            errorMsg.innerText = "";

            let passenger = {
                Pclass: parseInt(document.getElementById("pclass").value),
                Sex: document.getElementById("sex").value,
                Age: parseFloat(document.getElementById("age").value),
                SibSp: parseInt(document.getElementById("sibsp").value),
                Parch: parseInt(document.getElementById("parch").value),
                Fare: parseFloat(document.getElementById("fare").value),
                Embarked: document.getElementById("embarked").value
            };

            // UI: loading state
            predictBtn.disabled = true;
            loadingMsg.innerText = "Calculating prediction...";
            resultCard.style.display = "none";

            try {
                let response = await fetch("http://127.0.0.1:5224/api/predict", {
                    method: "POST",
                    headers: { "Content-Type": "application/json" },
                    body: JSON.stringify(passenger)
                });

                let text = await response.text();
                console.log("Raw response:", text);

                let result = JSON.parse(text);

                const survived = result.result === "Survived";
                const prob = result.probability || 0;

                // adjust card style
                resultCard.classList.remove("result-survived","result-not-survived");
                resultCard.classList.add(
                    survived ? "result-survived" : "result-not-survived"
                );

                resultTitle.innerText = survived ? "Passenger is likely to SURVIVE" : "Passenger is likely to NOT SURVIVE";
                resultDetail.innerText = `Model prediction: ${result.result}`;
                probBar.style.width = prob + "%";
                probBar.style.background = survived ? "#16a34a" : "#dc2626";
                probValue.innerText = `Estimated survival probability: ${prob}%`;

                resultCard.style.display = "block";
            } catch (err) {
                console.error(err);
                errorMsg.innerText = "Something went wrong while predicting. Check console / backend logs.";
            } finally {
                loadingMsg.innerText = "";
                predictBtn.disabled = false;
            }
        });
    </script>
</body>
</html>
